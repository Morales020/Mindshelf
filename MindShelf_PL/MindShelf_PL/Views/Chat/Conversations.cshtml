@model IEnumerable<MindShelf_PL.Controllers.ChatController.ConversationVm>
@{
    ViewData["Title"] = "مراسلاتي";
}

<style>
    .conv-item{transition:background .2s ease}
    .conv-item:hover{background:rgba(13,110,253,.06)}
    body.dark-mode .conv-item{background:#1b1f26;border-color:#2a2d33;color:#e6e8eb}
    body.dark-mode .conv-item:hover{background:#222732}
    .conv-time{font-size:.78rem;color:#8a94a6}
    body.dark-mode .conv-time{color:#97a3b6}
    .conv-list{border-radius:12px; overflow:hidden}
    body.dark-mode .conv-list{box-shadow:0 2px 10px rgba(0,0,0,.35)}
</style>

<div class="container py-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h2 class="mb-0"><i class="fas fa-inbox"></i> مراسلاتي</h2>
    </div>

    <div class="list-group shadow-sm conv-list">
        @foreach (var c in Model)
        {
            var name = c.DisplayName ?? c.OtherUserId;
            var when = DateTime.SpecifyKind(c.LastMessageAt, DateTimeKind.Utc).ToLocalTime();
            <a class="list-group-item list-group-item-action d-flex align-items-center justify-content-between conv-item" href="@Url.Action("Private","Chat", new { userId = c.OtherUserId })">
                <div class="d-flex align-items-center">
                    @if (!string.IsNullOrWhiteSpace(c.AvatarUrl))
                    {
                        <img src="@c.AvatarUrl" class="rounded-circle me-3" style="width:40px;height:40px;object-fit:cover;" onerror="this.replaceWith(document.createElement('i'))" />
                    }
                    else
                    {
                        <i class="fas fa-user-circle me-3" style="font-size:40px;"></i>
                    }
                    <div>
                        <div class="fw-bold">@name</div>
                        <div class="conv-time">@when</div>
                    </div>
                </div>
                @if (c.UnreadCount > 0)
                {
                    <span class="badge bg-danger rounded-pill">@c.UnreadCount</span>
                }
            </a>
        }
    </div>

    @section Scripts {
    <script>
        // No total badge here to avoid confusion; per-item badges already shown.
    </script>
    }
</div>


